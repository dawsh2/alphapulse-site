<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0969da" id="theme-color">
    <title>Deploy - AlphaPulse</title>
    
    <!-- Shared styles with Full Stack Open design -->
    <link rel="stylesheet" href="shared.css">
    
    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    
    <!-- Page-specific styles -->
    <style>
        /* Layout */
        .deploy-container {
            display: grid;
            grid-template-rows: auto 1fr;
            height: calc(100vh - var(--header-height));
            overflow: hidden;
        }
        
        /* Status Bar */
        .status-bar {
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-border-primary);
            padding: var(--space-3) var(--space-4);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .status-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
        }
        
        .status-value {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }
        
        .status-value.positive {
            color: var(--color-accent-secondary);
        }
        
        .status-value.negative {
            color: var(--color-accent-danger);
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            background: var(--color-bg-tertiary);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--color-accent-secondary);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .live-dot.demo {
            background: var(--color-accent-warning);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        /* Main Content */
        .trading-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 0;
            height: 100%;
            overflow: hidden;
        }
        
        /* Chart Section */
        .chart-section {
            display: flex;
            flex-direction: column;
            background: var(--color-bg-primary);
        }
        
        .chart-header {
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-border-primary);
            padding: var(--space-3) var(--space-4);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .symbol-selector {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .symbol-name {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }
        
        .timeframe-selector {
            display: flex;
            gap: var(--space-1);
        }
        
        .timeframe-btn {
            padding: var(--space-1) var(--space-2);
            font-size: var(--font-size-xs);
        }
        
        .chart-container {
            flex: 1;
            position: relative;
            background: var(--color-bg-primary);
        }
        
        #chart {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        /* Sidebar */
        .trading-sidebar {
            background: var(--color-bg-secondary);
            border-left: 1px solid var(--color-border-primary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar-tabs {
            display: flex;
            background: var(--color-bg-tertiary);
            border-bottom: 1px solid var(--color-border-primary);
        }
        
        .sidebar-tab {
            flex: 1;
            padding: var(--space-3);
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            border-bottom: 2px solid transparent;
        }
        
        .sidebar-tab:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-secondary);
        }
        
        .sidebar-tab.active {
            color: var(--color-text-primary);
            border-bottom-color: var(--color-accent-primary);
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
        }
        
        /* Position Cards */
        .position-card {
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-3);
            margin-bottom: var(--space-3);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .position-card:hover {
            border-color: var(--color-border-secondary);
            transform: translateX(-2px);
        }
        
        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }
        
        .position-symbol {
            font-family: var(--font-family-mono);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
        }
        
        .position-pnl {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }
        
        .position-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2);
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }
        
        /* Order Form */
        .order-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .order-type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2);
        }
        
        .order-type-btn {
            padding: var(--space-3);
            border: 1px solid var(--color-border-primary);
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-md);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .order-type-btn:hover {
            border-color: var(--color-border-secondary);
        }
        
        .order-type-btn.buy {
            color: var(--color-accent-secondary);
        }
        
        .order-type-btn.sell {
            color: var(--color-accent-danger);
        }
        
        .order-type-btn.active {
            background: var(--color-accent-primary);
            color: white;
            border-color: var(--color-accent-primary);
        }
        
        /* Mobile Bottom Sheet */
        .mobile-drawer {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--color-bg-secondary);
            border-top: 1px solid var(--color-border-primary);
            border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
            transform: translateY(calc(100% - 60px));
            transition: transform var(--transition-base);
            max-height: 70vh;
            z-index: 100;
        }
        
        .mobile-drawer.open {
            transform: translateY(0);
        }
        
        .drawer-handle {
            padding: var(--space-3);
            cursor: pointer;
            text-align: center;
        }
        
        .drawer-handle-bar {
            width: 40px;
            height: 4px;
            background: var(--color-text-tertiary);
            border-radius: 2px;
            margin: 0 auto;
        }
        
        /* Event Log Styles */
        .event-log-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .event-item {
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-3);
            transition: all var(--transition-fast);
        }
        
        .event-item:hover {
            background: var(--color-bg-secondary);
            transform: translateX(-2px);
        }
        
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }
        
        .event-type {
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            text-transform: uppercase;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            letter-spacing: var(--letter-spacing-wide);
        }
        
        .event-type.buy {
            background: var(--color-accent-secondary);
            color: white;
        }
        
        .event-type.sell {
            background: var(--color-accent-danger);
            color: white;
        }
        
        .event-type.info {
            background: var(--color-accent-primary);
            color: white;
        }
        
        .event-type.warning {
            background: var(--color-accent-warning);
            color: white;
        }
        
        .event-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            font-family: var(--font-family-mono);
        }
        
        .event-details {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .event-symbol {
            font-family: var(--font-family-mono);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }
        
        .event-description {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }
        
        /* Mobile Styles */
        @media (max-width: 768px) {
            .deploy-container {
                height: calc(100vh - var(--mobile-header-height));
            }
            
            .status-bar {
                flex-wrap: wrap;
                padding: var(--space-2) var(--space-3);
            }
            
            .status-info {
                gap: var(--space-4);
            }
            
            .trading-grid {
                grid-template-columns: 1fr;
            }
            
            .trading-sidebar {
                display: none;
            }
            
            .mobile-drawer {
                display: block;
            }
            
            .chart-header {
                padding: var(--space-2) var(--space-3);
            }
            
            .symbol-name {
                font-size: var(--font-size-base);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header will be injected by layout.js -->
        
        <div class="deploy-container">
            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-info">
                    <div class="status-item">
                        <div class="status-label">Strategy</div>
                        <div class="status-value">Momentum</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">P&L Today</div>
                        <div class="status-value positive">+$1,234.56</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Positions</div>
                        <div class="status-value">3</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Win Rate</div>
                        <div class="status-value">68%</div>
                    </div>
                </div>
                <div class="live-indicator">
                    <span class="live-dot demo"></span>
                    <span>Paper Trading</span>
                </div>
            </div>
            
            <!-- Trading Grid -->
            <div class="trading-grid">
                <!-- Chart Section -->
                <div class="chart-section">
                    <div class="chart-header">
                        <div class="symbol-selector">
                            <span class="symbol-name">SPY</span>
                            <select class="form-input" style="width: auto; padding: var(--space-1) var(--space-2); font-size: var(--font-size-sm);">
                                <option>SPY - SPDR S&P 500</option>
                                <option>QQQ - Invesco QQQ</option>
                                <option>AAPL - Apple Inc.</option>
                                <option>TSLA - Tesla Inc.</option>
                            </select>
                        </div>
                        <div class="timeframe-selector">
                            <button class="btn btn-ghost timeframe-btn">1m</button>
                            <button class="btn btn-ghost timeframe-btn active">5m</button>
                            <button class="btn btn-ghost timeframe-btn">15m</button>
                            <button class="btn btn-ghost timeframe-btn">1h</button>
                            <button class="btn btn-ghost timeframe-btn">1d</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="chart"></div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="trading-sidebar">
                    <div class="sidebar-tabs">
                        <button class="sidebar-tab active" onclick="showTab('positions')">Positions</button>
                        <button class="sidebar-tab" onclick="showTab('orders')">Orders</button>
                        <button class="sidebar-tab" onclick="showTab('events')">Events</button>
                    </div>
                    
                    <div class="sidebar-content" id="positions-tab">
                        <div class="position-card">
                            <div class="position-header">
                                <span class="position-symbol">AAPL</span>
                                <span class="position-pnl positive">+$523.45</span>
                            </div>
                            <div class="position-details">
                                <div>
                                    <div class="status-label">Qty</div>
                                    <div>100 shares</div>
                                </div>
                                <div>
                                    <div class="status-label">Avg Price</div>
                                    <div>$182.34</div>
                                </div>
                                <div>
                                    <div class="status-label">Current</div>
                                    <div>$187.57</div>
                                </div>
                                <div>
                                    <div class="status-label">Return</div>
                                    <div class="positive">+2.87%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="position-card">
                            <div class="position-header">
                                <span class="position-symbol">TSLA</span>
                                <span class="position-pnl negative">-$234.50</span>
                            </div>
                            <div class="position-details">
                                <div>
                                    <div class="status-label">Qty</div>
                                    <div>50 shares</div>
                                </div>
                                <div>
                                    <div class="status-label">Avg Price</div>
                                    <div>$245.80</div>
                                </div>
                                <div>
                                    <div class="status-label">Current</div>
                                    <div>$241.11</div>
                                </div>
                                <div>
                                    <div class="status-label">Return</div>
                                    <div class="negative">-1.91%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="position-card">
                            <div class="position-header">
                                <span class="position-symbol">SPY</span>
                                <span class="position-pnl positive">+$945.34</span>
                            </div>
                            <div class="position-details">
                                <div>
                                    <div class="status-label">Qty</div>
                                    <div>200 shares</div>
                                </div>
                                <div>
                                    <div class="status-label">Avg Price</div>
                                    <div>$445.20</div>
                                </div>
                                <div>
                                    <div class="status-label">Current</div>
                                    <div>$449.93</div>
                                </div>
                                <div>
                                    <div class="status-label">Return</div>
                                    <div class="positive">+1.06%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sidebar-content" id="orders-tab" style="display: none;">
                        <p class="text-secondary text-sm">No recent orders</p>
                    </div>
                    
                    <div class="sidebar-content" id="new-order-tab" style="display: none;">
                        <form class="order-form">
                            <div class="form-group">
                                <label class="form-label">Symbol</label>
                                <input type="text" class="form-input" value="SPY" />
                            </div>
                            
                            <div class="order-type-selector">
                                <button type="button" class="order-type-btn buy active">Buy</button>
                                <button type="button" class="order-type-btn sell">Sell</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Quantity</label>
                                <input type="number" class="form-input" value="100" />
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Order Type</label>
                                <select class="form-input">
                                    <option>Market</option>
                                    <option>Limit</option>
                                    <option>Stop</option>
                                    <option>Stop Limit</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Submit Order</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Bottom Drawer -->
            <div class="mobile-drawer" id="mobileDrawer">
                <div class="drawer-handle" onclick="toggleDrawer()">
                    <div class="drawer-handle-bar"></div>
                </div>
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" onclick="showTab('positions')">Positions</button>
                    <button class="sidebar-tab" onclick="showTab('orders')">Orders</button>
                    <button class="sidebar-tab" onclick="showTab('new-order')">New Order</button>
                </div>
                <div class="sidebar-content" style="padding: var(--space-4);">
                    <!-- Mobile content mirrors desktop sidebar content -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Layout Manager -->
    <script src="layout.js"></script>
    
    <script>
        let chart;
        let candleSeries;
        let volumeSeries;
        let currentTab = 'positions';
        let drawerOpen = false;
        
        // Initialize chart
        function initChart() {
            // Check if LightweightCharts is loaded
            if (typeof LightweightCharts === 'undefined') {
                setTimeout(initChart, 100);
                return;
            }
            
            const chartElement = document.getElementById('chart');
            const theme = document.documentElement.getAttribute('data-theme') || 'light';
            const isDark = theme === 'dark';
            
            chart = LightweightCharts.createChart(chartElement, {
                width: chartElement.clientWidth,
                height: chartElement.clientHeight,
                layout: {
                    background: { color: isDark ? '#0d1117' : '#ffffff' },
                    textColor: isDark ? '#f0f6fc' : '#33332d',
                },
                grid: {
                    vertLines: { color: isDark ? '#30363d' : '#e1e1db' },
                    horzLines: { color: isDark ? '#30363d' : '#e1e1db' },
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                },
                rightPriceScale: {
                    borderColor: isDark ? '#30363d' : '#e1e1db',
                },
                timeScale: {
                    borderColor: isDark ? '#30363d' : '#e1e1db',
                    timeVisible: true,
                    secondsVisible: false,
                },
            });
            
            candleSeries = chart.addCandlestickSeries({
                upColor: '#3fb950',
                downColor: '#f85149',
                borderUpColor: '#3fb950',
                borderDownColor: '#f85149',
                wickUpColor: '#3fb950',
                wickDownColor: '#f85149',
            });
            
            // Generate mock data
            const data = generateMockData();
            candleSeries.setData(data);
            
            // Fit content
            chart.timeScale().fitContent();
        }
        
        // Generate mock market data
        function generateMockData() {
            const data = [];
            const basePrice = 450;
            const now = new Date();
            
            for (let i = 0; i < 100; i++) {
                const time = new Date(now.getTime() - (100 - i) * 5 * 60000); // 5 min bars
                const random = Math.random();
                const trend = Math.sin(i / 10) * 2;
                const noise = (random - 0.5) * 1;
                
                const open = basePrice + trend + noise + (i > 0 ? data[i-1].close - basePrice : 0) * 0.3;
                const close = open + (Math.random() - 0.5) * 0.5;
                const high = Math.max(open, close) + Math.random() * 0.3;
                const low = Math.min(open, close) - Math.random() * 0.3;
                
                data.push({
                    time: Math.floor(time.getTime() / 1000),
                    open,
                    high,
                    low,
                    close
                });
            }
            
            return data;
        }
        
        // Tab switching
        function showTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.sidebar-tab').forEach(tab => {
                const tabText = tab.textContent.toLowerCase();
                tab.classList.toggle('active', 
                    (tabName === 'positions' && tabText.includes('positions')) ||
                    (tabName === 'orders' && tabText.includes('orders')) ||
                    (tabName === 'events' && tabText.includes('events'))
                );
            });
            
            // Update content
            document.querySelectorAll('.sidebar-content').forEach(content => {
                content.style.display = 'none';
            });
            
            const activeTab = document.getElementById(`${tabName}-tab`);
            if (activeTab) {
                activeTab.style.display = 'block';
            }
            
            // Update mobile drawer content
            if (window.innerWidth <= 768) {
                const mobileContent = document.querySelector('.mobile-drawer .sidebar-content');
                if (mobileContent && activeTab) {
                    mobileContent.innerHTML = activeTab.innerHTML;
                }
            }
        }
        
        // Mobile drawer toggle
        function toggleDrawer() {
            const drawer = document.getElementById('mobileDrawer');
            drawerOpen = !drawerOpen;
            drawer.classList.toggle('open', drawerOpen);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (chart) {
                chart.applyOptions({
                    width: document.getElementById('chart').clientWidth,
                    height: document.getElementById('chart').clientHeight
                });
            }
        });
        
        // Handle theme changes
        window.addEventListener('alphapulse:themechange', (e) => {
            if (chart) {
                // Store current data
                const currentData = candleSeries ? candleSeries.data() : null;
                
                // Remove old chart
                chart.remove();
                chart = null;
                
                // Recreate chart with new theme
                initChart();
                
                // Restore data if available
                if (currentData && candleSeries) {
                    candleSeries.setData(currentData);
                }
            }
        });
        
        // Handle order type buttons
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('order-type-btn')) {
                e.preventDefault();
                document.querySelectorAll('.order-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                e.target.classList.add('active');
            }
        });
        
        // Initialize on load
        window.addEventListener('load', () => {
            initChart();
            
            // Real-time updates simulation
            setInterval(() => {
                if (candleSeries) {
                    const lastData = generateMockData().slice(-1)[0];
                    candleSeries.update(lastData);
                }
            }, 5000);
        });
    </script>
</body>
</html>