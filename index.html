<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4ec9b0" id="theme-color">
    <title>AlphaPulse - Quantitative Trading News</title>
    
    <!-- Shared styles with Full Stack Open design -->
    <link rel="stylesheet" href="shared.css">
    
    <!-- Inter font for NautilusTrader -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Newspaper fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Serif+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Page-specific styles -->
    <style>
        /* Override for newspaper feel */
        .news-container {
            font-family: 'Source Serif Pro', 'Georgia', serif;
            max-width: 100%;
            margin: 0;
            height: 100%;
            overflow: hidden;
        }
        
        /* Main Grid Layout */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-8);
            height: calc(100vh - var(--header-height));
            padding: var(--space-6);
            overflow: hidden;
        }
        
        /* Left Column - Link Submissions */
        .submissions-column {
            min-width: 0; /* Prevent overflow */
            overflow-y: auto;
            padding-right: var(--space-4);
            height: 100%;
            position: relative;
        }
        
        /* Page Navigation */
        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4) 0;
            margin-top: var(--space-4);
            border-top: 1px solid var(--color-border-primary);
        }
        
        .page-turner {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            font-family: var(--font-family-mono);
        }
        
        .page-btn {
            background: none;
            border: none;
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-1) var(--space-2);
            transition: color var(--transition-fast);
        }
        
        .page-btn:hover {
            color: var(--color-text-primary);
        }
        
        .page-current {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }
        
        .submit-link {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        .submit-link:hover {
            color: var(--color-accent-primary);
        }
        
        /* Search Bar */
        .search-wrapper {
            position: relative;
            flex: 1;
            max-width: 400px;
        }
        
        .search-input {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border-primary);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            transition: all var(--transition-fast);
        }
        
        .search-placeholder {
            position: absolute;
            left: var(--space-3);
            top: 50%;
            transform: translateY(-50%);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            color: var(--color-text-tertiary);
            pointer-events: none;
            transition: opacity var(--transition-fast);
        }
        
        .search-placeholder em {
            font-style: italic;
        }
        
        .search-input:focus ~ .search-placeholder,
        .search-input:not(:placeholder-shown) ~ .search-placeholder,
        .search-input:not([value=""]) ~ .search-placeholder {
            opacity: 0;
        }
        
        .search-input:focus {
            outline: none;
            background: var(--color-bg-primary);
            border-color: var(--color-accent-primary);
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }
        
        
        /* Article Styles */
        .article {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: var(--space-4);
            padding: var(--space-4) 0;
            border-bottom: 1px solid var(--color-border-primary);
            transition: all var(--transition-fast);
        }
        
        .article:hover {
            background-color: var(--color-text-primary);
            color: var(--color-bg-primary);
            margin-left: calc(-1 * var(--space-4));
            margin-right: calc(-1 * var(--space-4));
            padding-left: var(--space-4);
            padding-right: var(--space-4);
        }
        
        .article:hover .article-rank,
        .article:hover .article-headline,
        .article:hover .article-source,
        .article:hover .article-meta,
        .article:hover .article-meta a {
            color: var(--color-bg-primary);
        }
        
        .article:hover .article-source .dot {
            background: var(--color-bg-primary);
        }
        
        .article:hover .tag {
            color: var(--color-bg-primary);
            background-color: rgba(255, 255, 255, 0.2);
            border-color: var(--color-bg-primary);
        }
        
        .article-rank {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-tertiary);
            min-width: 40px;
            padding-top: var(--space-1);
        }
        
        .article-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .article-headline {
            font-family: 'Playfair Display', serif;
            font-size: var(--font-size-xl);
            font-weight: 700;
            line-height: var(--line-height-tight);
            color: var(--color-text-primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        .article-headline:hover {
            text-decoration: none;
        }
        
        .article-source {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }
        
        .article-source .dot {
            width: 3px;
            height: 3px;
            background: var(--color-text-tertiary);
            border-radius: 50%;
        }
        
        /* Article Tags */
        .article-tags {
            display: inline-flex;
            gap: var(--space-1);
            margin-left: var(--space-2);
        }
        
        .tag {
            display: inline-block;
            position: relative;
            padding: 2px 6px 2px 8px;
            font-size: 9px;
            font-weight: var(--font-weight-medium);
            text-transform: lowercase;
            letter-spacing: 0.3px;
            transition: all var(--transition-fast);
            margin-left: 6px;
            clip-path: polygon(6px 0, 100% 0, 100% 100%, 6px 100%, 0 50%);
            filter: drop-shadow(0 0 0.5px rgba(0, 0, 0, 0.15));
        }
        
        /* Tag color variants */
        .tag.ml {
            background: rgba(139, 92, 246, 0.1);
            color: #7c3aed;
        }
        
        .tag.rl {
            background: rgba(236, 72, 153, 0.1);
            color: #db2777;
        }
        
        .tag.hft {
            background: rgba(251, 146, 60, 0.1);
            color: #ea580c;
        }
        
        .tag.stats {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }
        
        .tag.options {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }
        
        .tag.quant {
            background: rgba(168, 85, 247, 0.1);
            color: #9333ea;
        }
        
        .tag.edu {
            background: rgba(14, 165, 233, 0.1);
            color: #0284c7;
        }
        
        .tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .article-meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-sm);
            color: var(--color-text-tertiary);
        }
        
        .article-meta a {
            color: var(--color-text-secondary);
            text-decoration: none;
        }
        
        .article-meta a:hover {
            text-decoration: none;
        }
        
        /* Right Column - Modified Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: var(--space-4);
            height: 100%;
            overflow: hidden;
        }
        
        
        /* Dashboard Cards */
        .dashboard-card {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .dashboard-card-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-3);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid var(--color-border-primary);
            display: none;
        }
        
        
        /* Sector Heatmap */
        .sector-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-2);
            height: 100%;
        }
        
        .sector-tile {
            padding: var(--space-3);
            text-align: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .sector-tile:hover {
            transform: scale(1.05);
        }
        
        .sector-name {
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
            margin-bottom: var(--space-1);
        }
        
        .sector-value {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
        }
        
        .sector-positive {
            background: rgba(63, 185, 80, 0.15);
            color: var(--color-accent-secondary);
        }
        
        .sector-negative {
            background: rgba(248, 81, 73, 0.15);
            color: var(--color-accent-danger);
        }
        
        .sector-neutral {
            background: var(--color-bg-tertiary);
            color: var(--color-text-secondary);
        }
        
        
        /* Placeholder Content */
        .placeholder-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-tertiary);
            font-size: var(--font-size-sm);
            text-align: center;
            padding: var(--space-4);
        }
        
        /* Earnings Calendar */
        .earnings-calendar {
            display: grid;
            grid-template-rows: repeat(2, 1fr);
            gap: var(--space-1);
            height: 100%;
            padding: var(--space-1);
        }
        
        .calendar-week {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--space-1);
        }
        
        .calendar-day {
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-sm);
            padding: var(--space-1);
            display: flex;
            flex-direction: column;
            min-height: 0;
            transition: all var(--transition-fast);
            cursor: pointer;
            font-size: var(--font-size-xs);
            position: relative;
        }
        
        .calendar-day:hover {
            background: var(--color-bg-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        /* Today */
        .calendar-day.today {
            background: var(--color-bg-secondary);
        }
        
        .calendar-day.today .day-name,
        .calendar-day.today .day-number {
            color: var(--color-text-primary);
            font-weight: var(--font-weight-semibold);
        }
        
        .calendar-day.today .earning-dot {
            background: transparent;
            color: var(--color-text-primary);
            border: 1px solid var(--color-text-primary);
        }
        
        /* Style 2: Minimal with bottom border */
        .calendar-day.style-minimal {
            background: transparent;
            border-bottom: 2px solid var(--color-accent-primary);
        }
        
        /* Style 3: Dot indicator style */
        .calendar-day.style-dot::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--color-accent-danger);
            border-radius: 50%;
        }
        
        /* Style 4: Gradient background */
        .calendar-day.style-gradient {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
        }
        
        /* Style 5: Outline only */
        .calendar-day.style-outline {
            background: transparent;
            border: 1px solid var(--color-text-primary);
        }
        
        /* Style 6: Corner accent */
        .calendar-day.style-corner::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 12px 12px 0;
            border-color: transparent var(--color-accent-warning) transparent transparent;
        }
        
        /* Style 7: Subtle shadow */
        .calendar-day.style-shadow {
            background: var(--color-bg-primary);
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        /* FOMC days - Blue highlight */
        .calendar-day.fed-day {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
        }
        
        .calendar-day.fed-day:hover {
            background: rgba(88, 166, 255, 0.15);
            border-color: rgba(88, 166, 255, 0.5);
        }
        
        .calendar-day.fed-day .day-number {
            font-weight: var(--font-weight-bold);
        }
        
        .fed-indicator {
            display: inline-block;
            font-size: 9px;
            font-weight: var(--font-weight-semibold);
            background: rgba(88, 166, 255, 0.2);
            color: var(--color-text-link);
            padding: 1px 4px;
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-1);
            text-transform: uppercase;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: var(--space-2);
            padding-bottom: var(--space-1);
            border-bottom: 1px solid var(--color-border-primary);
        }
        
        .calendar-day.today .day-header {
            border-bottom-color: var(--color-border-primary);
        }
        
        .day-name {
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
            color: var(--color-text-secondary);
        }
        
        .day-number {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }
        
        .day-earnings {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            flex: 1;
            overflow-y: auto;
        }
        
        .earning-dot {
            font-family: var(--font-family-mono);
            font-size: 9px;
            font-weight: var(--font-weight-semibold);
            background: transparent;
            color: var(--color-text-primary);
            border: 1px solid var(--color-text-primary);
            padding: 2px 4px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: inline-block;
            margin-right: 2px;
            margin-bottom: 2px;
        }
        
        .news-items-container {
            overflow-y: auto;
            flex: 1;
        }
        
        /* Watchlist */
        .watchlist-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            height: 100%;
            overflow-y: auto;
        }
        
        .watchlist-item {
            display: grid;
            grid-template-columns: 120px 140px auto;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            cursor: pointer;
        }
        
        .watchlist-item:hover {
            background: var(--color-bg-primary);
            transform: translateX(-2px);
        }
        
        /* Sparkline mini charts */
        .sparkline {
            height: 30px;
            width: 100%;
        }
        
        .sparkline svg {
            width: 100%;
            height: 100%;
        }
        
        .sparkline-path {
            fill: none;
            stroke: var(--color-text-primary);
            stroke-width: 1.5;
            stroke-linecap: round;
            stroke-linejoin: round;
            vector-effect: non-scaling-stroke;
        }
        
        /* Dark theme sparkline */
        [data-theme="dark"] .sparkline-path {
            stroke: var(--color-text-primary);
        }
        
        .ticker-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            min-width: 0; /* Allow text truncation */
        }
        
        .ticker {
            font-family: var(--font-family-mono);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
            color: var(--color-text-primary);
        }
        
        .ticker-name {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .ticker-price {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: var(--space-1);
            justify-self: end;
        }
        
        .price {
            font-family: var(--font-family-mono);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
            color: var(--color-text-primary);
        }
        
        .change {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }
        
        .change.positive {
            color: var(--color-accent-secondary);
        }
        
        .change.negative {
            color: var(--color-accent-danger);
        }
        
        .news-item {
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--color-border-primary);
        }
        
        .news-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .news-headline {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-snug);
            color: var(--color-text-primary);
            text-decoration: none;
            display: block;
            margin-bottom: var(--space-1);
        }
        
        .news-headline:hover {
            color: var(--color-accent-primary);
        }
        
        .news-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
        }
        
        /* Scrollbar styling */
        .submissions-column::-webkit-scrollbar {
            width: 8px;
        }
        
        .submissions-column::-webkit-scrollbar-track {
            background: var(--color-bg-secondary);
            border-radius: 4px;
        }
        
        .submissions-column::-webkit-scrollbar-thumb {
            background: var(--color-border-secondary);
            border-radius: 4px;
        }
        
        .submissions-column::-webkit-scrollbar-thumb:hover {
            background: var(--color-border-primary);
        }
        
        /* Right Column - Modified Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: var(--space-4);
            height: 100%;
            overflow: hidden;
            position: relative; /* For PDF overlay */
        }
        
        /* PDF Reader */
        .pdf-reader {
            position: fixed;
            top: var(--header-height);
            left: 50%;
            right: 0;
            bottom: 0;
            background: var(--color-bg-primary);
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-base);
            border-left: 1px solid var(--color-border-primary);
        }
        
        /* AI Chat Button */
        .ai-chat-button {
            position: absolute;
            bottom: var(--space-4);
            right: var(--space-4);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            padding: 0.6rem;
            background: var(--color-bg-primary);
            border: 3px solid var(--color-text-primary);
            border-radius: var(--radius-md);
            box-shadow: -3px 5px var(--color-text-primary);
            transition: all 150ms ease-in-out;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            margin-bottom: 5px;
        }
        
        .ai-chat-button:hover {
            color: var(--color-bg-primary);
            background: var(--color-text-primary);
            transform: translate(2px, -2px);
            box-shadow: -5px 7px var(--color-text-primary);
        }
        
        .ai-chat-button:active {
            transform: translate(-1px, 2px);
            box-shadow: -2px 3px var(--color-text-primary);
        }
        
        .ai-chat-button svg {
            width: 24px;
            height: 24px;
        }
        
        /* AI Chat Terminal */
        .ai-chat-terminal {
            position: fixed;
            bottom: 0;
            right: var(--space-6);
            width: 400px;
            height: 300px;
            min-width: 300px;
            min-height: 200px;
            max-width: 80vw;
            max-height: 80vh;
            background: var(--color-bg-primary);
            border: 2px solid var(--color-text-primary);
            display: none;
            flex-direction: column;
            z-index: var(--z-fixed);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            margin-bottom: calc(var(--space-6) + 56px + var(--space-3));
            overflow: hidden;
        }
        
        .ai-chat-resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            cursor: nwse-resize;
            z-index: 10;
        }
        
        .ai-chat-resize-handle::after {
            content: '';
            position: absolute;
            bottom: 3px;
            right: 3px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 0 10px 10px;
            border-color: transparent transparent var(--color-text-tertiary) transparent;
        }
        
        .ai-chat-terminal.open {
            display: flex;
        }
        
        .ai-chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-border-primary);
            cursor: move;
            user-select: none;
        }
        
        .ai-chat-title {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .ai-chat-close {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: var(--space-1);
            line-height: 1;
        }
        
        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
        }
        
        .ai-message {
            margin-bottom: var(--space-3);
            line-height: 1.6;
        }
        
        .ai-message.user {
            color: var(--color-text-secondary);
        }
        
        .ai-message.user::before {
            content: "> ";
            color: var(--color-accent-primary);
            font-weight: var(--font-weight-bold);
        }
        
        .ai-message.assistant {
            color: var(--color-text-primary);
            padding-left: var(--space-4);
        }
        
        .ai-chat-input-wrapper {
            display: flex;
            align-items: center;
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-secondary);
            border-top: 1px solid var(--color-border-primary);
            gap: var(--space-3);
        }
        
        .ai-chat-prompt {
            color: var(--color-text-primary);
            font-family: var(--font-family-mono);
            font-weight: var(--font-weight-bold);
        }
        
        .ai-chat-input {
            flex: 1;
            background: none;
            border: none;
            color: var(--color-text-primary);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            outline: none;
        }
        
        .ai-chat-input::placeholder {
            color: var(--color-text-tertiary);
        }
        
        /* PDF full width mode */
        .pdf-reader.fullwidth {
            left: 0;
            border-left: none;
        }
        
        /* Position PDF in submissions column */
        .submissions-column.has-overlay {
            position: relative;
        }
        
        /* Hide news content when overlay is active */
        .submissions-column.has-overlay .article-list,
        .submissions-column.has-overlay .page-navigation {
            display: none;
        }
        
        .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            border-bottom: 1px solid var(--color-border-primary);
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .editor-btn {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            text-decoration: none;
            letter-spacing: var(--letter-spacing-tight);
            padding: 0.4rem 0.8rem;
            background: var(--color-bg-primary);
            border: 3px solid var(--color-text-primary);
            border-radius: var(--radius-md);
            box-shadow: -3px 5px var(--color-text-primary);
            transition: all 150ms ease-in-out;
            cursor: pointer;
            line-height: 1;
            display: inline-flex;
            align-items: center;
            gap: 0;
        }
        
        .editor-btn:hover {
            color: var(--color-bg-primary);
            background: var(--color-text-primary);
            transform: translate(2px, -2px);
            box-shadow: -5px 7px var(--color-text-primary);
        }
        
        .editor-btn:hover .prompt {
            color: var(--color-bg-primary);
        }
        
        .editor-btn:active {
            transform: translate(-1px, 2px);
            box-shadow: -2px 3px var(--color-text-primary);
        }
        
        .pdf-title {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin: 0;
        }
        
        .pdf-close {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            padding: 0.3rem 0.6rem;
            background: var(--color-bg-primary);
            border: 3px solid var(--color-text-primary);
            border-radius: var(--radius-md);
            box-shadow: -3px 5px var(--color-text-primary);
            transition: all 150ms ease-in-out;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            line-height: 1;
        }
        
        .pdf-close:hover {
            color: var(--color-bg-primary);
            background: var(--color-text-primary);
            transform: translate(2px, -2px);
            box-shadow: -5px 7px var(--color-text-primary);
        }
        
        .pdf-close:active {
            transform: translate(-1px, 2px);
            box-shadow: -2px 3px var(--color-text-primary);
        }
        
        /* Floating close button for overlays */
        .pdf-reader.over-news .pdf-close,
        .comments-panel.over-news .comments-close {
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            z-index: 10;
        }
        
        .pdf-frame-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            background: #525659; /* PDF viewer background color */
        }
        
        .pdf-frame {
            position: absolute;
            top: -95px; /* Hide PDF viewer toolbar */
            left: -8px;
            width: calc(100% + 16px);
            height: calc(100% + 95px);
            border: none;
            transform: scale(1.65); /* Scale up to 165% zoom to fill horizontally */
            transform-origin: center center;
        }
        
        /* Comments Panel */
        .comments-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--color-bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-base);
        }
        
        /* Comments over news feed */
        .comments-panel.over-news {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            border-radius: 0;
            box-shadow: none;
        }
        
        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            border-bottom: 1px solid var(--color-border-primary);
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .comments-title {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin: 0;
        }
        
        .comments-close {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            padding: 0.3rem 0.6rem;
            background: var(--color-bg-primary);
            border: 3px solid var(--color-text-primary);
            border-radius: var(--radius-md);
            box-shadow: -3px 5px var(--color-text-primary);
            transition: all 150ms ease-in-out;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            line-height: 1;
        }
        
        .comments-close:hover {
            color: var(--color-bg-primary);
            background: var(--color-text-primary);
            transform: translate(2px, -2px);
            box-shadow: -5px 7px var(--color-text-primary);
        }
        
        .comments-close:active {
            transform: translate(-1px, 2px);
            box-shadow: -2px 3px var(--color-text-primary);
        }
        
        .comments-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .comments-list {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
        }
        
        .comment-item {
            margin-bottom: var(--space-3);
        }
        
        .comment-item:last-child {
            margin-bottom: 0;
        }
        
        .comment-thread {
            border-left: 2px solid var(--color-border-primary);
            padding-left: var(--space-3);
            margin-left: var(--space-2);
            margin-top: var(--space-2);
        }
        
        .comment-thread.collapsed {
            display: none;
        }
        
        .comment-content {
            background: var(--color-bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            margin-bottom: var(--space-2);
        }
        
        .comment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-2);
        }
        
        .comment-author {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }
        
        .comment-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            margin-left: var(--space-2);
        }
        
        .comment-toggle {
            background: none;
            border: none;
            color: var(--color-text-tertiary);
            cursor: pointer;
            font-size: var(--font-size-xs);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .comment-toggle:hover {
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
        }
        
        .comment-text {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            line-height: var(--line-height-relaxed);
            margin-bottom: var(--space-2);
        }
        
        .comment-actions {
            display: flex;
            gap: var(--space-3);
            font-size: var(--font-size-xs);
        }
        
        .comment-action {
            background: none;
            border: none;
            color: var(--color-text-tertiary);
            cursor: pointer;
            padding: 0;
            transition: color var(--transition-fast);
        }
        
        .comment-action:hover {
            color: var(--color-text-primary);
        }
        
        .reply-form {
            margin-top: var(--space-2);
            padding: var(--space-2);
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-sm);
            display: none;
        }
        
        .reply-form.active {
            display: block;
        }
        
        .reply-input {
            width: 100%;
            min-height: 40px;
            padding: var(--space-2);
            font-family: var(--font-family-sans);
            font-size: var(--font-size-xs);
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border-primary);
            border-radius: var(--radius-sm);
            color: var(--color-text-primary);
            resize: vertical;
            margin-bottom: var(--space-1);
        }
        
        .reply-buttons {
            display: flex;
            gap: var(--space-2);
            justify-content: flex-end;
        }
        
        .comment-form {
            padding: var(--space-4);
            border-top: 1px solid var(--color-border-primary);
            background: var(--color-bg-secondary);
        }
        
        .comment-input {
            width: 100%;
            min-height: 60px;
            padding: var(--space-2);
            font-family: var(--font-family-sans);
            font-size: var(--font-size-sm);
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border-primary);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            resize: vertical;
            margin-bottom: var(--space-2);
        }
        
        .comment-input:focus {
            outline: none;
            border-color: var(--color-accent-primary);
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }
        
        /* Mobile Styles */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: var(--space-6);
                height: auto;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: var(--space-4);
                height: auto;
            }
            
            .submissions-column {
                height: auto;
                max-height: 600px;
            }
        }
        
        @media (max-width: 768px) {
            .news-container {
                padding: var(--space-4);
                padding-top: var(--space-4);
            }
            
            .section-title {
                font-size: var(--font-size-xl);
            }
            
            .article {
                gap: var(--space-3);
            }
            
            .article-rank {
                min-width: 30px;
                font-size: var(--font-size-base);
            }
            
            .article-headline {
                font-size: var(--font-size-lg);
            }
            
            .sector-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-card {
                min-height: 200px;
            }
        }
        
        /* Notebook Viewer */
        .notebook-viewer {
            position: fixed;
            right: 0;
            top: var(--header-height);
            bottom: 0;
            width: 50%;
            background: var(--color-bg-primary);
            border-left: 1px solid var(--color-border-primary);
            box-shadow: -4px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .notebook-header {
            padding: var(--space-4);
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-border-primary);
        }
        
        .notebook-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .notebook-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            font-family: var(--font-family-mono);
            flex: 1;
            text-align: center;
            margin: 0 var(--space-3);
        }
        
        .notebook-action-btn {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            padding: 0.5rem 1rem;
            background: var(--color-bg-primary);
            border: 3px solid var(--color-text-primary);
            border-radius: var(--radius-md);
            box-shadow: -3px 5px var(--color-text-primary);
            transition: all 150ms ease-in-out;
            cursor: pointer;
            margin-bottom: 5px;
        }
        
        .notebook-action-btn:hover {
            color: var(--color-bg-primary);
            background: var(--color-text-primary);
            transform: translate(2px, -2px);
            box-shadow: -5px 7px var(--color-text-primary);
        }
        
        .notebook-action-btn:active {
            transform: translate(-1px, 2px);
            box-shadow: -2px 3px var(--color-text-primary);
        }
        
        .notebook-close {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            padding: 0.3rem 0.6rem;
            background: var(--color-bg-primary);
            border: 3px solid var(--color-text-primary);
            border-radius: var(--radius-md);
            box-shadow: -3px 5px var(--color-text-primary);
            transition: all 150ms ease-in-out;
            cursor: pointer;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .notebook-close:hover {
            color: var(--color-bg-primary);
            background: var(--color-text-primary);
            transform: translate(2px, -2px);
            box-shadow: -5px 7px var(--color-text-primary);
        }
        
        .notebook-close:active {
            transform: translate(-1px, 2px);
            box-shadow: -2px 3px var(--color-text-primary);
        }
        
        .notebook-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
        }
        
        /* Notebook Cells */
        .notebook-cell {
            margin-bottom: var(--space-4);
            border: 1px solid var(--color-border-primary);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        /* Powered by NautilusTrader */
        .powered-by-nautilus {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: var(--space-6) 0 var(--space-4);
            margin-top: var(--space-4);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .powered-by-text {
            font-size: 14px;
            color: var(--color-text-secondary);
            font-weight: 400;
        }
        
        .nautilus-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            transition: opacity var(--transition-fast);
        }
        
        .nautilus-link:hover {
            opacity: 0.8;
            text-decoration: none;
        }
        
        .nautilus-logo {
            height: 24px;
            width: auto;
            filter: brightness(0) saturate(100%);
        }
        
        /* Invert logo in light theme to make it visible */
        :root[data-theme="light"] .nautilus-logo {
            filter: brightness(0) saturate(100%) invert(0);
        }
        
        /* Keep logo white in dark theme */
        :root[data-theme="dark"] .nautilus-logo {
            filter: none;
        }
        
        .nautilus-text {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--color-text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .cell-type {
            padding: var(--space-2) var(--space-3);
            background: var(--color-bg-tertiary);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
            text-transform: uppercase;
            letter-spacing: var(--letter-spacing-wide);
            color: var(--color-text-secondary);
        }
        
        .cell-content {
            padding: var(--space-4);
            background: var(--color-bg-secondary);
        }
        
        .cell-content pre {
            margin: 0;
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
        }
        
        .cell-output {
            padding: var(--space-4);
            background: var(--color-bg-primary);
            border-top: 1px solid var(--color-border-primary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header will be injected by layout.js -->
        
        <main class="main" style="padding: 0; height: calc(100vh - var(--header-height)); overflow: hidden;">
            <div class="news-container">
                <div class="content-grid">
                    <!-- Left Column - Link Submissions -->
                    <div class="submissions-column">
                        <div class="article-list">
                            <article class="article">
                                <span class="article-rank">1.</span>
                                <div class="article-content">
                                    <a href="https://arxiv.org/abs/2312.04951" class="article-headline">
                                        Deep Reinforcement Learning for Optimal Order Execution
                                    </a>
                                    <div class="article-source">
                                        <span>arXiv:2312.04951</span>
                                        <span class="dot"></span>
                                        <span>Zhang et al.</span>
                                        <div class="article-tags">
                                            <span class="tag rl">rl</span>
                                            <span class="tag hft">hft</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>287 points</span>
                                        <span>•</span>
                                        <a href="#" class="comments-link" data-article-id="1" data-count="56">56 comments</a>
                                        <span>•</span>
                                        <span>2 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">2.</span>
                                <div class="article-content">
                                    <a href="#" class="article-headline">
                                        Why Your Sharpe Ratio is Lying: A Statistical Deep Dive
                                    </a>
                                    <div class="article-source">
                                        <span>QuantBlog</span>
                                        <span class="dot"></span>
                                        <span>statistician42</span>
                                        <div class="article-tags">
                                            <span class="tag stats">stats</span>
                                            <span class="tag edu">edu</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>234 points</span>
                                        <span>•</span>
                                        <a href="#" class="comments-link" data-article-id="2" data-count="89">89 comments</a>
                                        <span>•</span>
                                        <span>4 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">3.</span>
                                <div class="article-content">
                                    <a href="https://arxiv.org/abs/2401.00123" class="article-headline">
                                        Transformer-Based Feature Engineering for HFT
                                    </a>
                                    <div class="article-source">
                                        <span>arXiv:2401.00123</span>
                                        <span class="dot"></span>
                                        <span>Chen, Liu, Wang</span>
                                        <div class="article-tags">
                                            <span class="tag ml">ml</span>
                                            <span class="tag hft">hft</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>189 points</span>
                                        <span>•</span>
                                        <a href="#">42 comments</a>
                                        <span>•</span>
                                        <span>5 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">4.</span>
                                <div class="article-content">
                                    <a href="#" class="article-headline">
                                        Show AP: Real-Time Options Flow Scanner
                                    </a>
                                    <div class="article-source">
                                        <span>Show AlphaPulse</span>
                                        <span class="dot"></span>
                                        <span>optionswhale</span>
                                        <div class="article-tags">
                                            <span class="tag options">options</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>156 points</span>
                                        <span>•</span>
                                        <a href="#">67 comments</a>
                                        <span>•</span>
                                        <span>6 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">5.</span>
                                <div class="article-content">
                                    <a href="#" class="article-headline">
                                        Market Microstructure in the Age of Retail
                                    </a>
                                    <div class="article-source">
                                        <span>MarketStructure.io</span>
                                        <span class="dot"></span>
                                        <span>microstructguru</span>
                                        <div class="article-tags">
                                            <span class="tag hft">hft</span>
                                            <span class="tag quant">quant</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>134 points</span>
                                        <span>•</span>
                                        <a href="#">91 comments</a>
                                        <span>•</span>
                                        <span>8 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">6.</span>
                                <div class="article-content">
                                    <a href="https://arxiv.org/abs/2401.00456" class="article-headline">
                                        Causal Inference in Financial Time Series
                                    </a>
                                    <div class="article-source">
                                        <span>arXiv:2401.00456</span>
                                        <span class="dot"></span>
                                        <span>Patel, Robinson</span>
                                        <div class="article-tags">
                                            <span class="tag stats">stats</span>
                                            <span class="tag ml">ml</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>121 points</span>
                                        <span>•</span>
                                        <a href="#">34 comments</a>
                                        <span>•</span>
                                        <span>10 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">7.</span>
                                <div class="article-content">
                                    <a href="#" class="article-headline">
                                        The Hidden Cost of Overfitting: A Post-Mortem
                                    </a>
                                    <div class="article-source">
                                        <span>Personal Blog</span>
                                        <span class="dot"></span>
                                        <span>humbledtrader</span>
                                        <div class="article-tags">
                                            <span class="tag ml">ml</span>
                                            <span class="tag edu">edu</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>98 points</span>
                                        <span>•</span>
                                        <a href="#">123 comments</a>
                                        <span>•</span>
                                        <span>12 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">8.</span>
                                <div class="article-content">
                                    <a href="#" class="article-headline">
                                        Ask AP: Favorite Lesser-Known Technical Indicators?
                                    </a>
                                    <div class="article-source">
                                        <span>Ask AlphaPulse</span>
                                        <span class="dot"></span>
                                        <span>community</span>
                                    </div>
                                    <div class="article-meta">
                                        <span>87 points</span>
                                        <span>•</span>
                                        <a href="#">156 comments</a>
                                        <span>•</span>
                                        <span>14 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">9.</span>
                                <div class="article-content">
                                    <a href="https://arxiv.org/abs/2401.00789" class="article-headline">
                                        Graph Neural Networks for Cross-Sectional Momentum
                                    </a>
                                    <div class="article-source">
                                        <span>arXiv:2401.00789</span>
                                        <span class="dot"></span>
                                        <span>Kim, Park, Lee</span>
                                        <div class="article-tags">
                                            <span class="tag ml">ml</span>
                                            <span class="tag quant">quant</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>76 points</span>
                                        <span>•</span>
                                        <a href="#">28 comments</a>
                                        <span>•</span>
                                        <span>16 hours ago</span>
                                    </div>
                                </div>
                            </article>
                            
                            <article class="article">
                                <span class="article-rank">10.</span>
                                <div class="article-content">
                                    <a href="#" class="article-headline">
                                        Python vs Rust for Backtesting: Performance Comparison
                                    </a>
                                    <div class="article-source">
                                        <span>TechBlog</span>
                                        <span class="dot"></span>
                                        <span>rustquant</span>
                                        <div class="article-tags">
                                            <span class="tag quant">quant</span>
                                            <span class="tag edu">edu</span>
                                        </div>
                                    </div>
                                    <div class="article-meta">
                                        <span>65 points</span>
                                        <span>•</span>
                                        <a href="#">94 comments</a>
                                        <span>•</span>
                                        <span>18 hours ago</span>
                                    </div>
                                </div>
                            </article>
                        </div>
                        
                        <!-- Page Navigation with Search -->
                        <div class="page-navigation">
                            <div class="page-turner">
                                <button class="page-btn" aria-label="Previous page">&lt;</button>
                                <span class="page-current">1</span>
                                <button class="page-btn" aria-label="Next page">&gt;</button>
                            </div>
                            <div class="search-wrapper">
                                <input type="search" class="search-input" id="searchInput" />
                                <span class="search-placeholder" id="searchPlaceholder">search... e.g., <em>keyword</em> or tag=x</span>
                            </div>
                            <a href="#" class="submit-link">submit</a>
                        </div>
                        
                        <!-- Powered by NautilusTrader -->
                        <div class="powered-by-nautilus">
                            <span class="powered-by-text">Powered by</span>
                            <a href="https://nautilustrader.io/" target="_blank" rel="noopener noreferrer" class="nautilus-link">
                                <img src="https://nautilustrader.io/_next/image/?url=%2Fnautilus-logo-white.png&w=128&q=75" alt="NautilusTrader" class="nautilus-logo" />
                            </a>
                        </div>
                    </div>
                    
                    <!-- Right Column - Modified Grid -->
                    <div class="dashboard-grid">
                        <!-- PDF Reader Overlay -->
                        <div class="pdf-reader" id="pdfReader" style="display: none;">
                            <div class="pdf-header">
                                <button class="editor-btn" onclick="openInEditor()" title="Open in Editor">
                                    <span class="prompt">&gt;</span>_
                                </button>
                                <h3 class="pdf-title">Loading...</h3>
                                <button class="pdf-close" onclick="closePdfReader()">×</button>
                            </div>
                            <div class="pdf-frame-container">
                                <iframe class="pdf-frame" id="pdfFrame" src=""></iframe>
                            </div>
                            
                        </div>
                        
                        <!-- Comments Panel -->
                        <div class="comments-panel" id="commentsPanel" style="display: none;">
                            <div class="comments-header">
                                <h3 class="comments-title">Comments</h3>
                                <button class="comments-close" onclick="closeComments()">×</button>
                            </div>
                            <div class="comments-container">
                                <div class="comments-list" id="commentsList">
                                    <!-- Comments will be populated here -->
                                </div>
                                <div class="comment-form">
                                    <textarea class="comment-input" placeholder="Add a comment..."></textarea>
                                    <button class="btn btn-primary btn-sm">Post</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Top Left: Sector Heatmap -->
                        <div class="dashboard-card">
                            <!-- Sector Heatmap -->
                            <div class="sector-grid">
                                <div class="sector-tile sector-positive">
                                    <div class="sector-name">Tech</div>
                                    <div class="sector-value">+2.34%</div>
                                </div>
                                <div class="sector-tile sector-positive">
                                    <div class="sector-name">Finance</div>
                                    <div class="sector-value">+1.82%</div>
                                </div>
                                <div class="sector-tile sector-negative">
                                    <div class="sector-name">Energy</div>
                                    <div class="sector-value">-0.91%</div>
                                </div>
                                <div class="sector-tile sector-neutral">
                                    <div class="sector-name">Health</div>
                                    <div class="sector-value">+0.12%</div>
                                </div>
                                <div class="sector-tile sector-negative">
                                    <div class="sector-name">Real Est</div>
                                    <div class="sector-value">-1.45%</div>
                                </div>
                                <div class="sector-tile sector-positive">
                                    <div class="sector-name">Cons Disc</div>
                                    <div class="sector-value">+0.87%</div>
                                </div>
                                <div class="sector-tile sector-negative">
                                    <div class="sector-name">Utilities</div>
                                    <div class="sector-value">-0.33%</div>
                                </div>
                                <div class="sector-tile sector-positive">
                                    <div class="sector-name">Comm</div>
                                    <div class="sector-value">+1.23%</div>
                                </div>
                                <div class="sector-tile sector-neutral">
                                    <div class="sector-name">Materials</div>
                                    <div class="sector-value">+0.08%</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Top Right: Watchlist -->
                        <div class="dashboard-card">
                            <div class="watchlist-container">
                                <div class="watchlist-item">
                                    <div class="ticker-info">
                                        <span class="ticker">SPY</span>
                                        <span class="ticker-name">S&P 500 ETF</span>
                                    </div>
                                    <div class="sparkline" data-ticker="SPY">
                                        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
                                            <polyline class="sparkline-path" points="0,35 10,30 20,32 30,28 40,25 50,22 60,24 70,20 80,18 90,15 100,10" />
                                        </svg>
                                    </div>
                                    <div class="ticker-price">
                                        <span class="price">$423.45</span>
                                        <span class="change positive">+1.2%</span>
                                    </div>
                                </div>
                                <div class="watchlist-item">
                                    <div class="ticker-info">
                                        <span class="ticker">VIX</span>
                                        <span class="ticker-name">Volatility Index</span>
                                    </div>
                                    <div class="sparkline" data-ticker="VIX">
                                        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
                                            <polyline class="sparkline-path" points="0,10 10,15 20,18 30,22 40,28 50,35 60,32 70,30 80,28 90,30 100,35" />
                                        </svg>
                                    </div>
                                    <div class="ticker-price">
                                        <span class="price">15.23</span>
                                        <span class="change negative">-5.4%</span>
                                    </div>
                                </div>
                                <div class="watchlist-item">
                                    <div class="ticker-info">
                                        <span class="ticker">GLD</span>
                                        <span class="ticker-name">Gold ETF</span>
                                    </div>
                                    <div class="sparkline" data-ticker="GLD">
                                        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
                                            <polyline class="sparkline-path" points="0,25 10,22 20,20 30,18 40,15 50,12 60,10 70,8 80,10 90,12 100,10" />
                                        </svg>
                                    </div>
                                    <div class="ticker-price">
                                        <span class="price">$189.76</span>
                                        <span class="change positive">+0.8%</span>
                                    </div>
                                </div>
                                <div class="watchlist-item">
                                    <div class="ticker-info">
                                        <span class="ticker">DXY</span>
                                        <span class="ticker-name">US Dollar Index</span>
                                    </div>
                                    <div class="sparkline" data-ticker="DXY">
                                        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
                                            <polyline class="sparkline-path" points="0,20 10,22 20,25 30,23 40,25 50,28 60,30 70,28 80,30 90,32 100,30" />
                                        </svg>
                                    </div>
                                    <div class="ticker-price">
                                        <span class="price">103.45</span>
                                        <span class="change negative">-0.3%</span>
                                    </div>
                                </div>
                                <div class="watchlist-item">
                                    <div class="ticker-info">
                                        <span class="ticker">NVDA</span>
                                        <span class="ticker-name">NVIDIA</span>
                                    </div>
                                    <div class="sparkline" data-ticker="NVDA">
                                        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
                                            <polyline class="sparkline-path" points="0,35 10,32 20,30 30,25 40,20 50,15 60,12 70,8 80,5 90,3 100,2" />
                                        </svg>
                                    </div>
                                    <div class="ticker-price">
                                        <span class="price">$486.20</span>
                                        <span class="change positive">+4.2%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bottom Left: Earnings Calendar -->
                        <div class="dashboard-card">
                            <div class="earnings-calendar">
                                <div class="calendar-week">
                                    <div class="calendar-day today">
                                        <div class="day-header">
                                            <span class="day-name">Mon</span>
                                            <span class="day-number">15</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="earning-dot">AAPL</div>
                                            <div class="earning-dot">MSFT</div>
                                        </div>
                                    </div>
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Tue</span>
                                            <span class="day-number">16</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="earning-dot">NFLX</div>
                                        </div>
                                    </div>
                                    <div class="calendar-day fed-day">
                                        <div class="day-header">
                                            <span class="day-name">Wed</span>
                                            <span class="day-number">17</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="fed-indicator">FOMC</div>
                                            <div class="earning-dot">TSLA</div>
                                            <div class="earning-dot">IBM</div>
                                            <div class="earning-dot">ASML</div>
                                        </div>
                                    </div>
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Thu</span>
                                            <span class="day-number">18</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="earning-dot">GOOGL</div>
                                            <div class="earning-dot">AMZN</div>
                                        </div>
                                    </div>
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Fri</span>
                                            <span class="day-number">19</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="earning-dot">VZ</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="calendar-week">
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Mon</span>
                                            <span class="day-number">22</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="earning-dot">META</div>
                                            <div class="earning-dot">V</div>
                                        </div>
                                    </div>
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Tue</span>
                                            <span class="day-number">23</span>
                                        </div>
                                        <div class="day-earnings">
                                        </div>
                                    </div>
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Wed</span>
                                            <span class="day-number">24</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="earning-dot">BA</div>
                                        </div>
                                    </div>
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Thu</span>
                                            <span class="day-number">25</span>
                                        </div>
                                        <div class="day-earnings">
                                            <div class="earning-dot">INTC</div>
                                            <div class="earning-dot">F</div>
                                        </div>
                                    </div>
                                    <div class="calendar-day">
                                        <div class="day-header">
                                            <span class="day-name">Fri</span>
                                            <span class="day-number">26</span>
                                        </div>
                                        <div class="day-earnings">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bottom Right: Market News -->
                        <div class="dashboard-card">
                            <div class="news-items-container">
                                <div class="news-item">
                                    <a href="#" class="news-headline">Fed Minutes Suggest Cautious Approach to Rate Cuts</a>
                                    <div class="news-time">15 minutes ago</div>
                                </div>
                                
                                <div class="news-item">
                                    <a href="#" class="news-headline">Tech Earnings Beat Expectations, Nasdaq Futures Rise</a>
                                    <div class="news-time">47 minutes ago</div>
                                </div>
                                
                                <div class="news-item">
                                    <a href="#" class="news-headline">Oil Prices Slide on Surprise Inventory Build</a>
                                    <div class="news-time">1 hour ago</div>
                                </div>
                                
                                <div class="news-item">
                                    <a href="#" class="news-headline">Dollar Strengthens Against Major Currencies</a>
                                    <div class="news-time">2 hours ago</div>
                                </div>
                                
                                <div class="news-item">
                                    <a href="#" class="news-headline">European Markets Close Mixed Amid Earnings Season</a>
                                    <div class="news-time">3 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- AI Chat Terminal (Global) -->
    <div class="ai-chat-terminal" id="aiChatTerminal">
        <div class="ai-chat-header">
            <div class="ai-chat-title">
                <span>AI Assistant</span>
                <span style="font-size: var(--font-size-xs); color: var(--color-text-tertiary);">How can I help you?</span>
            </div>
            <button class="ai-chat-close" onclick="closeAIChat()">×</button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message assistant">Hello! I can help you with trading strategies, market analysis, and understanding documents. What would you like to know?</div>
        </div>
        <div class="ai-chat-input-wrapper">
            <span class="ai-chat-prompt">></span>
            <input 
                type="text" 
                class="ai-chat-input" 
                id="aiChatInput" 
                placeholder="Ask a question..."
                onkeypress="handleAIChatInput(event)"
            />
        </div>
        <div class="ai-chat-resize-handle"></div>
    </div>
    
    <!-- Notebook Viewer -->
    <div class="notebook-viewer" id="notebookViewer" style="display: none;">
        <div class="notebook-header">
            <div class="notebook-actions">
                <button class="notebook-action-btn" onclick="openInResearch()" title="Open in Research Tab">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 20px; height: 20px;">
                        <!-- Spiral binding -->
                        <circle cx="4" cy="4" r="1.5"></circle>
                        <circle cx="4" cy="8" r="1.5"></circle>
                        <circle cx="4" cy="12" r="1.5"></circle>
                        <circle cx="4" cy="16" r="1.5"></circle>
                        <circle cx="4" cy="20" r="1.5"></circle>
                        <!-- Notebook pages -->
                        <rect x="7" y="2" width="14" height="20" rx="1"></rect>
                        <!-- Lines on pages -->
                        <line x1="10" y1="7" x2="18" y2="7"></line>
                        <line x1="10" y1="11" x2="18" y2="11"></line>
                        <line x1="10" y1="15" x2="16" y2="15"></line>
                    </svg>
                </button>
                <span class="notebook-title">Options Flow Scanner</span>
                <button class="notebook-close" onclick="closeNotebook()">×</button>
            </div>
        </div>
        <div class="notebook-content" id="notebookContent">
            <!-- Notebook cells will be loaded here -->
        </div>
    </div>
    
    <!-- Layout Manager -->
    <script src="layout.js"></script>
    
    <!-- Page-specific scripts -->
    <script>
        // Simulate real-time updates
        function updateMarketData() {
            // Update sector values
            document.querySelectorAll('.sector-tile').forEach(tile => {
                const currentValue = parseFloat(tile.querySelector('.sector-value').textContent);
                const change = (Math.random() - 0.5) * 0.1;
                const newValue = currentValue + change;
                tile.querySelector('.sector-value').textContent = newValue >= 0 ? `+${newValue.toFixed(2)}%` : `${newValue.toFixed(2)}%`;
                
                // Update color class
                tile.classList.remove('sector-positive', 'sector-negative', 'sector-neutral');
                if (newValue > 0.5) {
                    tile.classList.add('sector-positive');
                } else if (newValue < -0.5) {
                    tile.classList.add('sector-negative');
                } else {
                    tile.classList.add('sector-neutral');
                }
            });
            
        }
        
        // Update market data every 30 seconds
        setInterval(updateMarketData, 30000);
        
        // Update timestamps
        function updateTimestamps() {
            // In a real app, this would update relative timestamps
            console.log('Updating timestamps...');
        }
        
        // Update timestamps every minute
        setInterval(updateTimestamps, 60000);
        
        // Page navigation
        document.querySelectorAll('.page-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const currentPage = document.querySelector('.page-current');
                const current = parseInt(currentPage.textContent);
                
                if (e.target.textContent === '<' && current > 1) {
                    currentPage.textContent = current - 1;
                } else if (e.target.textContent === '>') {
                    currentPage.textContent = current + 1;
                }
            });
        });
        
        // Track what panels are open
        let pdfReaderOpen = false;
        let commentsOpen = false;
        
        // arXiv PDF reader
        function openPdfReader(url, title) {
            const pdfReader = document.getElementById('pdfReader');
            const pdfFrame = document.getElementById('pdfFrame');
            const pdfTitle = document.querySelector('.pdf-title');
            const submissionsColumn = document.querySelector('.submissions-column');
            const dashboardGrid = document.querySelector('.dashboard-grid');
            
            // Convert arXiv abstract URL to PDF URL
            let pdfUrl = url;
            if (url.includes('arxiv.org/abs/')) {
                pdfUrl = url.replace('/abs/', '/pdf/') + '.pdf';
            }
            
            // Set title and URL
            pdfTitle.textContent = title || 'Loading PDF...';
            pdfFrame.src = pdfUrl;
            
            // Show reader
            pdfReader.style.display = 'flex';
            pdfReaderOpen = true;
            
            // Set focus to enable keyboard shortcuts
            setTimeout(() => {
                document.getElementById('pdfReader').focus();
            }, 100);
        }
        
        function closePdfReader() {
            const pdfReader = document.getElementById('pdfReader');
            const pdfFrame = document.getElementById('pdfFrame');
            const submissionsColumn = document.querySelector('.submissions-column');
            const dashboardGrid = document.querySelector('.dashboard-grid');
            
            // Hide reader
            pdfReader.style.display = 'none';
            pdfFrame.src = '';
            pdfReaderOpen = false;
            
            // Also close AI chat if open
            closeAIChat();
        }
        
        // AI Chat Functions
        let aiChatOpen = false;
        let isDragging = false;
        let isResizing = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;
        let startWidth;
        let startHeight;
        let startX;
        let startY;
        
        function toggleAIChat() {
            const terminal = document.getElementById('aiChatTerminal');
            const button = document.querySelector('.global-ai-chat-button');
            
            if (aiChatOpen) {
                closeAIChat();
            } else {
                terminal.classList.add('open');
                if (button) button.classList.add('hidden');
                document.getElementById('aiChatInput').focus();
                aiChatOpen = true;
                
                // Initialize drag functionality
                initDrag();
            }
        }
        
        // Make it globally available
        window.toggleGlobalAIChat = toggleAIChat;
        
        function closeAIChat() {
            const terminal = document.getElementById('aiChatTerminal');
            const button = document.querySelector('.global-ai-chat-button');
            
            if (terminal) {
                terminal.classList.remove('open');
                if (button) button.classList.remove('hidden');
                aiChatOpen = false;
            }
        }
        
        function handleAIChatInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('aiChatInput');
                const messages = document.getElementById('aiChatMessages');
                const question = input.value.trim();
                
                if (question) {
                    // Add user message
                    const userMsg = document.createElement('div');
                    userMsg.className = 'ai-message user';
                    userMsg.textContent = question;
                    messages.appendChild(userMsg);
                    
                    // Clear input
                    input.value = '';
                    
                    // Simulate AI response
                    setTimeout(() => {
                        const aiMsg = document.createElement('div');
                        aiMsg.className = 'ai-message assistant';
                        
                        // Mock responses based on keywords
                        if (question.toLowerCase().includes('abstract') || question.toLowerCase().includes('summary')) {
                            aiMsg.textContent = 'This paper presents a novel approach to cross-sectional momentum using graph neural networks. The authors demonstrate that incorporating network effects between assets can improve momentum strategy performance by 15-20% compared to traditional methods.';
                        } else if (question.toLowerCase().includes('method')) {
                            aiMsg.textContent = 'The methodology involves constructing a graph where nodes represent assets and edges represent correlation relationships. A GNN is then trained to predict future returns based on both individual asset features and network structure.';
                        } else if (question.toLowerCase().includes('result')) {
                            aiMsg.textContent = 'Key results include: (1) 1.8 Sharpe ratio vs 1.2 for baseline momentum, (2) Lower drawdowns during market stress periods, (3) Better performance in small-cap universe where traditional momentum struggles.';
                        } else if (question.toLowerCase().includes('code') || question.toLowerCase().includes('implement')) {
                            aiMsg.textContent = 'The authors provide PyTorch implementation details in Section 4. The GNN architecture uses 3 graph convolutional layers with ReLU activation, followed by a fully connected layer for return prediction. Training uses AdamW optimizer with learning rate 0.001.';
                        } else {
                            aiMsg.textContent = `Analyzing the PDF for information about "${question}". The paper discusses various aspects of momentum strategies and neural network applications in finance. Would you like me to focus on a specific section?`;
                        }
                        
                        messages.appendChild(aiMsg);
                        messages.scrollTop = messages.scrollHeight;
                    }, 800);
                }
            }
        }
        
        // Open in Editor function
        function openInEditor() {
            const pdfTitle = document.querySelector('.pdf-title').textContent;
            const pdfFrame = document.getElementById('pdfFrame');
            const pdfUrl = pdfFrame.src;
            
            // Generate implementation code based on the PDF title
            let implementationCode = '';
            
            if (pdfTitle.includes('Graph Neural Networks')) {
                implementationCode = `"""
Graph Neural Networks for Cross-Sectional Momentum
Implementation based on arXiv paper

This implementation provides a PyTorch-based GNN model for
momentum strategy using graph convolutional layers.
"""

import torch
import torch.nn as nn
import torch.nn.functional as F
from torch_geometric.nn import GCNConv, global_mean_pool
import numpy as np
import pandas as pd


class MomentumGNN(nn.Module):
    """Graph Neural Network for momentum prediction"""
    
    def __init__(self, num_features, hidden_dim=64, num_layers=3, dropout=0.2):
        super(MomentumGNN, self).__init__()
        
        self.convs = nn.ModuleList()
        self.convs.append(GCNConv(num_features, hidden_dim))
        
        for _ in range(num_layers - 2):
            self.convs.append(GCNConv(hidden_dim, hidden_dim))
            
        self.convs.append(GCNConv(hidden_dim, 1))
        
        self.dropout = dropout
        self.activation = nn.ReLU()
        
    def forward(self, x, edge_index, batch):
        # Apply GCN layers with ReLU and dropout
        for i, conv in enumerate(self.convs[:-1]):
            x = conv(x, edge_index)
            x = self.activation(x)
            x = F.dropout(x, p=self.dropout, training=self.training)
        
        # Final layer
        x = self.convs[-1](x, edge_index)
        
        return x


# Example usage
if __name__ == "__main__":
    # Initialize model
    model = MomentumGNN(num_features=5, hidden_dim=64, num_layers=3)
    
    print("Model initialized successfully!")
    print(f"Total parameters: {sum(p.numel() for p in model.parameters())}")
`;
            } else {
                // Generic implementation template
                implementationCode = `"""
Implementation of: ${pdfTitle.trim()}

TODO: Add paper-specific implementation details
"""

import numpy as np
import pandas as pd
import torch
import torch.nn as nn

class PaperImplementation:
    """Implementation of the paper's main algorithm"""
    
    def __init__(self):
        # Initialize your implementation
        pass
    
    def process(self, data):
        # Main processing logic
        pass

# Add your implementation here
`;
            }
            
            // Store the code and PDF info in sessionStorage
            sessionStorage.setItem('editorCode', implementationCode);
            sessionStorage.setItem('editorFilename', 'paper_implementation.py');
            sessionStorage.setItem('pdfUrl', pdfUrl);
            sessionStorage.setItem('pdfTitle', pdfTitle);
            sessionStorage.setItem('openWithPdf', 'true');
            
            // Open develop.html in same tab
            window.location.href = 'develop.html';
        }
        
        // Notebook functions
        let notebookOpen = false;
        
        function openNotebook(title) {
            const notebookViewer = document.getElementById('notebookViewer');
            const notebookContent = document.getElementById('notebookContent');
            const notebookTitle = document.querySelector('.notebook-title');
            
            // Set title
            notebookTitle.textContent = title || 'Options Flow Scanner';
            
            // Generate notebook content
            const cells = generateNotebookCells();
            notebookContent.innerHTML = cells;
            
            // Show notebook
            notebookViewer.style.display = 'flex';
            notebookOpen = true;
        }
        
        function closeNotebook() {
            const notebookViewer = document.getElementById('notebookViewer');
            notebookViewer.style.display = 'none';
            notebookOpen = false;
        }
        
        function generateNotebookCells() {
            return `
                <div class="notebook-cell">
                    <div class="cell-type">Markdown</div>
                    <div class="cell-content">
                        <h2>Options Flow Scanner</h2>
                        <p>Real-time scanner for unusual options activity and large block trades.</p>
                    </div>
                </div>
                
                <div class="notebook-cell">
                    <div class="cell-type">Code</div>
                    <div class="cell-content">
                        <pre>import pandas as pd
import numpy as np
from datetime import datetime, timedelta

# Configuration for options flow scanner
FLOW_THRESHOLD = 1000000  # $1M minimum
VOLUME_RATIO = 5.0       # 5x average volume
IV_PERCENTILE = 90       # High IV percentile</pre>
                    </div>
                </div>
                
                <div class="notebook-cell">
                    <div class="cell-type">Code</div>
                    <div class="cell-content">
                        <pre># Scan for unusual options activity
def scan_options_flow(symbol_list):
    orders = []
    
    for symbol in symbol_list:
        options = get_options_chain(symbol)
        
        for option in options:
            if (option.volume > option.avg_volume * VOLUME_RATIO and
                option.premium * option.volume > FLOW_THRESHOLD):
                
                orders.append({
                    'symbol': symbol,
                    'strike': option.strike,
                    'expiry': option.expiry,
                    'type': option.type,
                    'volume': option.volume,
                    'premium': option.premium,
                    'flow': option.premium * option.volume
                })
    
    return pd.DataFrame(orders).sort_values('flow', ascending=False)</pre>
                    </div>
                </div>
                
                <div class="notebook-cell">
                    <div class="cell-type">Code</div>
                    <div class="cell-content">
                        <pre># Run the scanner
top_symbols = ['SPY', 'QQQ', 'AAPL', 'TSLA', 'NVDA', 'AMD', 'MSFT', 'AMZN', 'META', 'GOOGL']
unusual_flows = scan_options_flow(top_symbols)
print(f"Found {len(unusual_flows)} unusual options flows")</pre>
                    </div>
                    <div class="cell-output">
                        <pre>Found 47 unusual options flows

Top 5 flows:
TSLA 300C 12/15 - Volume: 25,432 - Flow: $12.7M
NVDA 500C 01/19 - Volume: 18,221 - Flow: $9.1M  
SPY 430P 12/08 - Volume: 45,123 - Flow: $8.9M
AAPL 185C 12/15 - Volume: 22,145 - Flow: $6.6M
QQQ 380C 12/22 - Volume: 15,432 - Flow: $5.4M</pre>
                    </div>
                </div>
                
                <div class="notebook-cell">
                    <div class="cell-type">Markdown</div>
                    <div class="cell-content">
                        <h3>Flow Analysis</h3>
                        <p>The scanner identified significant bullish activity in tech names, particularly TSLA and NVDA with large call volumes. SPY puts suggest hedging activity.</p>
                    </div>
                </div>
                
                <div class="notebook-cell">
                    <div class="cell-type">Code</div>
                    <div class="cell-content">
                        <pre># Visualize options flow by sector
import matplotlib.pyplot as plt

sector_flows = unusual_flows.groupby('sector')['flow'].sum()
plt.figure(figsize=(10, 6))
sector_flows.plot(kind='bar', color='#4ec9b0')
plt.title('Options Flow by Sector')
plt.ylabel('Total Flow ($M)')
plt.xlabel('Sector')
plt.xticks(rotation=45)
plt.show()</pre>
                    </div>
                    <div class="cell-output">
                        <p style="color: var(--color-text-secondary); font-style: italic;">
                            [Bar chart showing Technology sector with highest flow at $45M, followed by Consumer Discretionary at $23M]
                        </p>
                    </div>
                </div>
            `;
        }
        
        function openInResearch() {
            // Save notebook data to sessionStorage
            sessionStorage.setItem('notebookTitle', 'Options Flow Scanner');
            sessionStorage.setItem('notebookType', 'options-flow');
            sessionStorage.setItem('openWithNotebook', 'true');
            
            // Navigate to research tab
            window.location.href = 'research.html';
        }
        
        // Add click handlers to arXiv links
        document.querySelectorAll('a[href*="arxiv.org"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const title = link.textContent;
                openPdfReader(link.href, title);
            });
        });
        
        // Add click handler for Options Flow Scanner
        document.querySelectorAll('.article-headline').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const title = link.textContent.trim();
                if (title.includes('Options Flow Scanner')) {
                    openNotebook(title);
                }
            });
        });
        
        // Handle search input placeholder
        const searchInput = document.getElementById('searchInput');
        const searchPlaceholder = document.getElementById('searchPlaceholder');
        
        if (searchInput && searchPlaceholder) {
            searchInput.addEventListener('input', () => {
                if (searchInput.value.length > 0) {
                    searchPlaceholder.style.opacity = '0';
                } else {
                    searchPlaceholder.style.opacity = '1';
                }
            });
        }
        
        // Mock comments data with nested replies
        const mockComments = {
            1: [
                { 
                    id: 1,
                    author: 'quantdev', 
                    time: '1 hour ago', 
                    text: 'Great paper! The approach to order execution is really innovative. Has anyone tried implementing this in production?',
                    replies: [
                        {
                            id: 11,
                            author: 'prod_trader',
                            time: '50 minutes ago',
                            text: 'We\'ve been running a modified version for 3 months. Happy to share results offline.',
                            replies: [
                                {
                                    id: 111,
                                    author: 'quantdev',
                                    time: '45 minutes ago',
                                    text: 'That would be amazing! Just DMed you.'
                                }
                            ]
                        },
                        {
                            id: 12,
                            author: 'ml_engineer',
                            time: '40 minutes ago',
                            text: 'The training data requirements seem pretty hefty. How much historical data did you use?'
                        }
                    ]
                },
                { 
                    id: 2,
                    author: 'algotrader23', 
                    time: '45 minutes ago', 
                    text: 'We tested a similar approach but found the computational overhead was too high for real-time trading. Curious about their latency numbers.',
                    replies: []
                },
                { 
                    id: 3,
                    author: 'ml_researcher', 
                    time: '30 minutes ago', 
                    text: 'The reinforcement learning framework here could be adapted for other optimization problems. Really solid work.',
                    replies: []
                },
                { 
                    id: 4,
                    author: 'hft_pro', 
                    time: '15 minutes ago', 
                    text: 'Implementation details in section 4.2 are gold. This could significantly reduce slippage.',
                    replies: []
                }
            ],
            2: [
                { 
                    id: 5,
                    author: 'stats_nerd', 
                    time: '2 hours ago', 
                    text: 'Finally someone addressing the overfitting issues with Sharpe ratio optimization!',
                    replies: []
                },
                { 
                    id: 6,
                    author: 'risk_manager', 
                    time: '1 hour ago', 
                    text: 'The bootstrap analysis in this post is exactly what I needed for my quarterly report.',
                    replies: []
                }
            ]
        };
        
        // Create a comment element with nesting
        function createCommentElement(comment, depth = 0) {
            const commentEl = document.createElement('div');
            commentEl.className = 'comment-item';
            commentEl.dataset.commentId = comment.id;
            
            const hasReplies = comment.replies && comment.replies.length > 0;
            const replyCount = hasReplies ? comment.replies.length : 0;
            
            commentEl.innerHTML = `
                <div class="comment-content">
                    <div class="comment-header">
                        <div>
                            <span class="comment-author">${comment.author}</span>
                            <span class="comment-time">${comment.time}</span>
                        </div>
                        ${hasReplies ? `<button class="comment-toggle" onclick="toggleReplies(${comment.id})">[−] ${replyCount} ${replyCount === 1 ? 'reply' : 'replies'}</button>` : ''}
                    </div>
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-actions">
                        <button class="comment-action" onclick="showReplyForm(${comment.id})">reply</button>
                        <button class="comment-action">share</button>
                    </div>
                    <div class="reply-form" id="reply-form-${comment.id}">
                        <textarea class="reply-input" placeholder="Write a reply..."></textarea>
                        <div class="reply-buttons">
                            <button class="btn btn-ghost btn-sm" onclick="hideReplyForm(${comment.id})">Cancel</button>
                            <button class="btn btn-primary btn-sm" onclick="postReply(${comment.id})">Reply</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add nested replies
            if (hasReplies) {
                const threadEl = document.createElement('div');
                threadEl.className = 'comment-thread';
                threadEl.id = `thread-${comment.id}`;
                
                comment.replies.forEach(reply => {
                    threadEl.appendChild(createCommentElement(reply, depth + 1));
                });
                
                commentEl.appendChild(threadEl);
            }
            
            return commentEl;
        }
        
        // Handle comments
        function openComments(articleId, articleTitle) {
            const commentsPanel = document.getElementById('commentsPanel');
            const commentsList = document.getElementById('commentsList');
            const commentsTitle = document.querySelector('.comments-title');
            const submissionsColumn = document.querySelector('.submissions-column');
            const dashboardGrid = document.querySelector('.dashboard-grid');
            
            // Update title
            commentsTitle.textContent = `Comments`;
            
            // Clear existing comments
            commentsList.innerHTML = '';
            
            // Add comments with nesting
            const comments = mockComments[articleId] || [];
            comments.forEach(comment => {
                commentsList.appendChild(createCommentElement(comment));
            });
            
            // If PDF is already open, show comments over news feed
            if (pdfReaderOpen) {
                commentsPanel.classList.add('over-news');
                submissionsColumn.classList.add('has-overlay');
                submissionsColumn.appendChild(commentsPanel);
            } else {
                commentsPanel.classList.remove('over-news');
                submissionsColumn.classList.remove('has-overlay');
                dashboardGrid.appendChild(commentsPanel);
            }
            
            // Show panel
            commentsPanel.style.display = 'flex';
            commentsOpen = true;
        }
        
        function closeComments() {
            const commentsPanel = document.getElementById('commentsPanel');
            const submissionsColumn = document.querySelector('.submissions-column');
            const dashboardGrid = document.querySelector('.dashboard-grid');
            
            commentsPanel.style.display = 'none';
            commentsPanel.classList.remove('over-news');
            commentsOpen = false;
            
            // Move back to dashboard if needed
            if (commentsPanel.parentElement === submissionsColumn) {
                dashboardGrid.appendChild(commentsPanel);
                submissionsColumn.classList.remove('has-overlay');
            }
        }
        
        // Toggle replies visibility
        function toggleReplies(commentId) {
            const thread = document.getElementById(`thread-${commentId}`);
            const toggle = event.target;
            
            if (thread.classList.contains('collapsed')) {
                thread.classList.remove('collapsed');
                toggle.textContent = toggle.textContent.replace('[+]', '[−]');
            } else {
                thread.classList.add('collapsed');
                toggle.textContent = toggle.textContent.replace('[−]', '[+]');
            }
        }
        
        // Show reply form
        function showReplyForm(commentId) {
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            replyForm.classList.add('active');
            replyForm.querySelector('textarea').focus();
        }
        
        // Hide reply form
        function hideReplyForm(commentId) {
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            replyForm.classList.remove('active');
            replyForm.querySelector('textarea').value = '';
        }
        
        // Post reply (mock)
        function postReply(commentId) {
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            const replyText = replyForm.querySelector('textarea').value;
            
            if (replyText.trim()) {
                alert(`Reply posted: "${replyText}"`);
                hideReplyForm(commentId);
            }
        }
        
        // Handle comments links
        document.querySelectorAll('.comments-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const articleId = link.dataset.articleId;
                const articleTitle = link.closest('.article').querySelector('.article-headline').textContent.trim();
                openComments(articleId, articleTitle);
            });
        });
        
        // Draggable and Resizable functionality for AI Chat
        function initDrag() {
            const terminal = document.getElementById('aiChatTerminal');
            const header = terminal.querySelector('.ai-chat-header');
            const resizeHandle = terminal.querySelector('.ai-chat-resize-handle');
            
            header.addEventListener('mousedown', dragStart);
            resizeHandle.addEventListener('mousedown', resizeStart);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }
        
        function dragStart(e) {
            const terminal = document.getElementById('aiChatTerminal');
            
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
            
            if (e.target.closest('.ai-chat-header') && !e.target.closest('button')) {
                isDragging = true;
                terminal.style.transition = 'none';
            }
        }
        
        function resizeStart(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const terminal = document.getElementById('aiChatTerminal');
            isResizing = true;
            
            startX = e.clientX;
            startY = e.clientY;
            startWidth = parseInt(document.defaultView.getComputedStyle(terminal).width, 10);
            startHeight = parseInt(document.defaultView.getComputedStyle(terminal).height, 10);
            
            terminal.style.transition = 'none';
        }
        
        function handleMouseMove(e) {
            if (isDragging) {
                drag(e);
            } else if (isResizing) {
                resize(e);
            }
        }
        
        function handleMouseUp(e) {
            if (isDragging) {
                dragEnd(e);
            } else if (isResizing) {
                resizeEnd(e);
            }
        }
        
        function drag(e) {
            e.preventDefault();
            
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;
            
            xOffset = currentX;
            yOffset = currentY;
            
            const terminal = document.getElementById('aiChatTerminal');
            terminal.style.transform = `translate(${currentX}px, ${currentY}px)`;
        }
        
        function resize(e) {
            e.preventDefault();
            
            const terminal = document.getElementById('aiChatTerminal');
            const newWidth = startWidth - (e.clientX - startX);
            const newHeight = startHeight - (e.clientY - startY);
            
            // Apply constraints
            const constrainedWidth = Math.max(300, Math.min(newWidth, window.innerWidth * 0.8));
            const constrainedHeight = Math.max(200, Math.min(newHeight, window.innerHeight * 0.8));
            
            terminal.style.width = constrainedWidth + 'px';
            terminal.style.height = constrainedHeight + 'px';
        }
        
        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            
            isDragging = false;
            
            const terminal = document.getElementById('aiChatTerminal');
            terminal.style.transition = '';
        }
        
        function resizeEnd(e) {
            isResizing = false;
            
            const terminal = document.getElementById('aiChatTerminal');
            terminal.style.transition = '';
        }
    </script>
</body>
</html>